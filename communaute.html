<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>LGBL – Communauté</title>
  <meta name="description" content="Avis des clients, live timing, liens officiels (TikTok), et envoi de clips pour la communauté LGBL Virtual Experience."/>

  <!-- SEO / Social -->
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="LGBL VIRTUAL CENTER EXPERIENCE" />
  <meta property="og:title" content="LGBL – Communauté" />
  <meta property="og:description" content="Avis 5★, live timing en direct et envoi de vos clips. Rejoignez la communauté LGBL !" />
  <meta property="og:image" content="assets/img/logo-lgbl.png" />

  <link rel="icon" type="image/png" href="assets/img/logo-lgbl.png" />
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600;800&family=Poppins:wght@400;600;700&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="assets/css/styles.css"/>

  <style>
    :root{--line:rgba(255,255,255,.08);--bg:#0a0b0d;--panel:#0f1115;--text:#e9ecef;--muted:#a9b3bb;--rose:#ff2d6f;--cyan:#00aaff}
    body{background:var(--bg);color:var(--text);font-family:Poppins,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;margin:0}
    .container{max-width:1150px;margin:0 auto;padding:0 20px}

    header{position:sticky;top:0;z-index:60;background:rgba(10,11,13,.7);backdrop-filter:saturate(120%) blur(8px);border-bottom:1px solid var(--line)}
    .nav{display:flex;align-items:center;justify-content:space-between;height:64px}
    .logo{display:inline-flex;align-items:center;gap:.6rem;color:#fff;text-decoration:none;font-weight:800;letter-spacing:.5px}
    .logo img{height:42px;border-radius:50%}
    nav .links a{color:#cfd6dc;text-decoration:none;padding:8px 12px;border:1px solid transparent;border-radius:999px}
    nav .links a:hover,nav .links a[aria-current="page"]{color:#fff;border-color:rgba(0,170,255,.35)}

    .hero{position:relative;overflow:hidden;padding:56px 0;border-bottom:1px solid var(--line);background:#0b0d11}
    .hero>.container{position:relative;z-index:2;text-align:center}
    .hero h1{font-family:'Orbitron';font-size:clamp(28px,5.6vw,44px);letter-spacing:1px;margin:0 0 .6rem;text-transform:uppercase}
    .subtitle{color:var(--muted)}

    .section{padding:40px 0;border-top:1px solid var(--line)}
    .section h2{font-family:'Orbitron';letter-spacing:.5px;margin:0 0 14px}
    .grid-2{display:grid;grid-template-columns:repeat(2,1fr);gap:18px}
    .grid-3{display:grid;grid-template-columns:repeat(3,1fr);gap:18px}
    @media (max-width:960px){.grid-2,.grid-3{grid-template-columns:1fr}}

    .card{background:var(--panel);border:1px solid var(--line);border-radius:16px;padding:18px;transition:.18s ease;transition-property:transform,box-shadow,border-color}
    .card.hoverable:hover{transform:translateY(-4px);box-shadow:0 16px 36px rgba(0,0,0,.35);border-color:rgba(0,170,255,.35)}
    .card h3{margin:.2rem 0 .4rem}
    .muted{color:var(--muted)}

    /* Avis */
    .rating{display:inline-flex;gap:2px;font-size:1.05rem;line-height:1}
    .star{filter:drop-shadow(0 0 6px rgba(255,200,0,.2))}
    .star.filled{color:#ffd166}
    .review{display:flex;gap:12px}
    .avatar{width:42px;height:42px;border-radius:50%;background:#151a20;border:1px solid var(--line);display:flex;align-items:center;justify-content:center;font-weight:700}
    .review-head{display:flex;align-items:center;gap:8px;justify-content:space-between}
    .reviews-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:18px}
    @media(max-width:960px){.reviews-grid{grid-template-columns:1fr}}
    .summary{display:flex;align-items:center;gap:12px}
    .summary .score{font-size:1.6rem;font-weight:800}

    .stars-input{display:flex;flex-direction:row-reverse;justify-content:flex-end;gap:6px}
    .stars-input input{display:none}
    .stars-input label{cursor:pointer;font-size:1.4rem;transition:transform .1s ease}
    .stars-input label:hover{transform:scale(1.1)}
    .stars-input input:checked ~ label,
    .stars-input label:hover,
    .stars-input label:hover ~ label { color:#ffd166; }

    /* Live timing */
    .lt-toolbar{display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin-bottom:10px}
    .input{background:#0e1218;border:1px solid var(--line);color:#e9f3ff;border-radius:10px;padding:8px 10px;min-width:300px}
    .btn{display:inline-block;background:linear-gradient(90deg,var(--rose),var(--cyan));padding:.6rem .9rem;border-radius:999px;color:#fff;text-decoration:none;font-weight:700;border:0}
    .btn.secondary{background:transparent;border:1px solid rgba(0,170,255,.35)}
    iframe{border:1px solid var(--line);border-radius:14px}

    footer{border-top:1px solid var(--line)}
  </style>
</head>
<body class="page-communaute">

<header>
  <div class="container nav">
    <a class="logo" href="index.html" aria-label="LGBL Accueil">
      <img src="assets/img/logo-lgbl.png" alt="Logo LGBL"/>
      <span>LGBL VIRTUAL CENTER EXPERIENCE</span>
    </a>
    <nav class="links" aria-label="Navigation principale">
      <a href="index.html">Accueil</a>
      <a href="tarifs.html">Tarifs</a>
      <a href="evenements.html">Événements</a>
      <a href="communaute.html" aria-current="page">Communauté</a>
      <a href="contact.html">Contact</a>
      <a href="https://www.youtube.com/@LucasGaly24/streams" target="_blank" rel="noopener">LIVE</a>
    </nav>
  </div>
</header>

<section class="hero">
  <div class="container">
    <h1>Communauté</h1>
    <p class="subtitle">Avis des pilotes, live timing temps réel, TikTok, et envoi de vos meilleurs clips.</p>
  </div>
</section>

<main>
  <!-- Avis -->
  <section class="section" id="avis">
    <div class="container">
      <h2>⭐ Avis de la communauté</h2>

      <!-- Résumé note / compteur -->
      <div class="card" style="margin-bottom:14px;display:flex;justify-content:space-between;gap:16px;flex-wrap:wrap">
        <div class="summary">
          <span class="score" id="avgScore">5.0</span>
          <div>
            <div id="avgStars" class="rating" aria-label="Note moyenne">★★★★★</div>
            <div class="muted"><span id="reviewsCount">0</span> avis</div>
          </div>
        </div>
        <!-- Formulaire d'avis -->
        <form id="reviewForm" style="display:grid;grid-template-columns:220px 1fr auto;gap:10px;align-items:center">
          <input id="revName" type="text" placeholder="Votre prénom (ou nom)" required style="background:#0e1218;border:1px solid var(--line);color:#fff;border-radius:10px;padding:8px 10px">
          <div style="display:flex;gap:10px;align-items:center">
            <div class="stars-input" aria-label="Choisir une note sur 5">
              <input type="radio" id="star5" name="rate" value="5" required><label for="star5">★</label>
              <input type="radio" id="star4" name="rate" value="4"><label for="star4">★</label>
              <input type="radio" id="star3" name="rate" value="3"><label for="star3">★</label>
              <input type="radio" id="star2" name="rate" value="2"><label for="star2">★</label>
              <input type="radio" id="star1" name="rate" value="1"><label for="star1">★</label>
            </div>
            <small class="muted">(cliquez une étoile)</small>
          </div>
          <button class="btn" type="submit">Publier</button>
          <textarea id="revText" placeholder="Votre avis (max 300 caractères)" required maxlength="300" style="grid-column:1/-1;background:#0e1218;border:1px solid var(--line);color:#fff;border-radius:10px;padding:10px 12px"></textarea>
          <div style="grid-column:1/-1;display:flex;gap:8px;align-items:center;flex-wrap:wrap">
            <button class="btn secondary" type="button" id="sendToTeam">Envoyer à l’équipe</button>
            <small class="muted">Vos avis s’affichent localement sur votre navigateur. “Envoyer à l’équipe” ouvre votre e-mail pour modération.</small>
          </div>
        </form>
      </div>

      <!-- Grille d’avis (prédéfinis + utilisateurs) -->
      <div class="reviews-grid" id="reviewsGrid" style="margin-top:.8rem">
        <!-- Exemples existants -->
        <article class="card hoverable">
          <div class="review-head">
            <div class="review">
              <div class="avatar">AG</div>
              <div><strong>Anaïs G.</strong><div class="muted">Pilote débutante</div></div>
            </div>
            <div class="rating" aria-label="Note 5 sur 5">★★★★★</div>
          </div>
          <p>Matériel propre et prise en main rapide. Le staff est super sympa, je reviendrai !</p>
        </article>

        <article class="card hoverable">
          <div class="review-head">
            <div class="review">
              <div class="avatar">JM</div>
              <div><strong>Jean M.</strong><div class="muted">Habitué</div></div>
            </div>
            <div class="rating" aria-label="Note 5 sur 5">★★★★★</div>
          </div>
          <p>Les châssis dynamiques envoient du lourd. Bonne ambiance paddock, on s’y croit.</p>
        </article>

        <article class="card hoverable">
          <div class="review-head">
            <div class="review">
              <div class="avatar">CL</div>
              <div><strong>Chloé L.</strong><div class="muted">Visite en famille</div></div>
            </div>
            <div class="rating" aria-label="Note 4 sur 5">★★★★☆</div>
          </div>
          <p>On a passé un super moment, les enfants ont adoré. Vivement les prochains tournois !</p>
        </article>

        <article class="card hoverable">
          <div class="review-head">
            <div class="review">
              <div class="avatar">NB</div>
              <div><strong>Noé B.</strong><div class="muted">Local</div></div>
            </div>
            <div class="rating" aria-label="Note 5 sur 5">★★★★★</div>
          </div>
          <p><em>“Prix corrects pour le lancement”</em>. Le pack Standard 3×10 min est parfait pour se faire plaisir.</p>
        </article>

        <article class="card hoverable">
          <div class="review-head">
            <div class="review">
              <div class="avatar">BL</div>
              <div><strong>Baptiste L.</strong><div class="muted">Esport</div></div>
            </div>
            <div class="rating" aria-label="Note 4 sur 5">★★★★☆</div>
          </div>
          <p>Format Sprint du vendredi = top ! Bonne rotation de circuits et fair-play.</p>
        </article>

        <!-- 1★ unique -->
        <article class="card hoverable">
          <div class="review-head">
            <div class="review">
              <div class="avatar">DP</div>
              <div><strong>David P.</strong><div class="muted">Motard</div></div>
            </div>
            <div class="rating" aria-label="Note 1 sur 5">★☆☆☆☆</div>
          </div>
          <p>Pas de moto actuellement, c’est dommage.</p>
        </article>
      </div>
    </div>
  </section>

  <!-- Live timing -->
  <section class="section" id="live-timing">
    <div class="container">
      <h2>⏱️ Live Timing</h2>
      <p class="muted">Suivez les chronos en direct pendant les sessions et soirées eSport.</p>
      <div class="lt-toolbar">
        <input class="input" id="lt-url" type="url" value="http://80.11.31.77:8772/live-timing?server=0" aria-label="URL du live timing">
        <button class="btn" id="lt-apply" type="button">Mettre à jour</button>
        <button class="btn secondary" id="lt-reset" type="button">Réinitialiser</button>
      </div>
      <iframe id="lt-frame" title="Live Timing" src="http://80.11.31.77:8772/live-timing?server=0" width="100%" height="560" loading="lazy" referrerpolicy="no-referrer"></iframe>
      <p class="muted" style="margin-top:8px">Astuce : tu peux coller ici un autre lien de live timing, il sera mémorisé pour les prochaines visites.</p>
    </div>
  </section>

  <!-- Réseaux & envoi de clips -->
  <section class="section" id="reseaux">
    <div class="container">
      <h2>🔗 Réseaux & Partage</h2>
      <div class="grid-3" style="margin-top:.8rem">
        <article class="card hoverable">
          <h3>TikTok officiel</h3>
          <p class="muted">Reels, highlights et coulisses.</p>
          <a class="btn" href="https://www.tiktok.com/@lucasgaly1" target="_blank" rel="noopener">Ouvrir TikTok</a>
        </article>
        <article class="card hoverable">
          <h3>Envoyer une photo / un clip</h3>
          <p class="muted">Passe par le formulaire de contact, on s’occupe du reste.</p>
          <a class="btn btn-devis" href="contact.html?sujet=Envoi%20photo%20%2F%20clip#form" data-prefill='{"type":"Media","objet":"Envoi photo/clip","canal":"Site"}'>Via le formulaire</a>
        </article>
        <article class="card hoverable">
          <h3>LIVE & Replays</h3>
          <p class="muted">Nos directs et rediffusions YouTube.</p>
          <a class="btn" href="https://www.youtube.com/@LucasGaly24/streams" target="_blank" rel="noopener">Voir le LIVE</a>
        </article>
      </div>
    </div>
  </section>
</main>

<footer style="border-top:1px solid var(--line)">
  <div class="container" style="padding:26px 0;display:grid;grid-template-columns:2fr 1fr 1fr 1fr;gap:22px">
    <div>
      <div class="logo" style="display:flex;align-items:center;gap:.5rem">
        <img src="assets/img/logo-lgbl.png" alt="LGBL" style="height:22px;border-radius:50%">
        <span>LGBL Virtual Experience</span>
      </div>
      <p class="muted" style="margin-top:.5rem">© 2025 LGBL Virtual Experience Center — Conception : Lucas Galy</p>
    </div>
    <div>
      <h4>Le site</h4>
      <p><a href="index.html">Accueil</a><br><a href="tarifs.html">Tarifs</a><br><a href="evenements.html">Événements</a></p>
    </div>
    <div>
      <h4>Contact</h4>
      <p><a href="mailto:lucasgaly.47510@gmail.com">lucasgaly.47510@gmail.com</a><br><a href="tel:+33672392264">06 72 39 22 64</a></p>
    </div>
    <div>
      <h4>LIVE</h4>
      <p><a href="https://www.youtube.com/@LucasGaly24/streams" target="_blank" rel="noopener">YouTube</a></p>
    </div>
  </div>
</footer>

<div style="border-top:1px solid var(--line)">
  <div class="container" style="padding:14px 0 22px;display:flex;gap:12px;flex-wrap:wrap;justify-content:center;font-size:.95rem">
    <a href="mentions-legales.html">Mentions légales</a> · <a href="confidentialite.html">Confidentialité</a> · <a href="contact.html#form">Contact</a>
  </div>
</div>

<script>
  // Pré-remplissage bouton "Via le formulaire"
  document.querySelectorAll('.btn-devis').forEach(btn => {
    btn.addEventListener('click', () => {
      const data = btn.getAttribute('data-prefill');
      if(data){ try{ sessionStorage.setItem('lgbl_prefill', data); }catch(_){} }
    });
  });

  // Live Timing: mémoriser l'URL et la restaurer
  (function(){
    const KEY = 'lgbl_livetiming_url';
    const input = document.getElementById('lt-url');
    const frame = document.getElementById('lt-frame');
    const apply = document.getElementById('lt-apply');
    const reset = document.getElementById('lt-reset');

    try{
      const saved = localStorage.getItem(KEY);
      if(saved){ input.value = saved; frame.src = saved; }
    }catch(_){}

    apply.addEventListener('click', () => {
      const url = input.value.trim();
      if(!/^https?:\/\//.test(url)) { alert('Entre une URL valide commençant par http:// ou https://'); return; }
      frame.src = url;
      try{ localStorage.setItem(KEY, url); }catch(_){ }
    });

    reset.addEventListener('click', () => {
      const def = 'http://80.11.31.77:8772/live-timing?server=0';
      input.value = def; frame.src = def;
      try{ localStorage.removeItem(KEY); }catch(_){ }
    });
  })();

  // ---------- Avis : stockage local + moyenne + envoi mail ----------
  (function(){
    const KEY = 'lgbl_reviews';
    const form = document.getElementById('reviewForm');
    const nameEl = document.getElementById('revName');
    const textEl = document.getElementById('revText');
    const grid = document.getElementById('reviewsGrid');
    const avgScore = document.getElementById('avgScore');
    const avgStars = document.getElementById('avgStars');
    const reviewsCount = document.getElementById('reviewsCount');
    const sendBtn = document.getElementById('sendToTeam');

    function getReviews(){
      try{ return JSON.parse(localStorage.getItem(KEY) || '[]'); }catch(e){ return []; }
    }
    function saveReviews(arr){
      try{ localStorage.setItem(KEY, JSON.stringify(arr)); }catch(_){}
    }
    function initials(name){
      const p = (name||'').trim().split(/\s+/);
      return (p[0]?.[0]||'U').toUpperCase() + (p[1]?.[0]||'').toUpperCase();
    }
    function starLine(n){
      const full = '★★★★★'.slice(0, n);
      const rest = '☆☆☆☆☆'.slice(n);
      return full + rest;
    }
    function renderUserReview(r){
      const card = document.createElement('article');
      card.className = 'card hoverable';
      card.innerHTML = `
        <div class="review-head">
          <div class="review">
            <div class="avatar">${initials(r.name)}</div>
            <div><strong>${escapeHtml(r.name)}</strong><div class="muted">Avis utilisateur</div></div>
          </div>
          <div class="rating" aria-label="Note ${r.rate} sur 5">${starLine(r.rate)}</div>
        </div>
        <p>${escapeHtml(r.text)}</p>
      `;
      grid.prepend(card); // dernier avis en premier
    }
    function escapeHtml(s){ return (s||'').replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }

    function updateSummary(){
      const baseCount = grid.querySelectorAll('.card.hoverable').length; // contient aussi les 6 exemples
      const custom = getReviews();
      const total = 6 + custom.length; // 6 avis statiques ci-dessus
      reviewsCount.textContent = total;

      // Moyenne basée sur : 5,5,4,5,4,1 (exemples) + avis utilisateurs
      const baseSum = 5+5+4+5+4+1;
      const userSum = custom.reduce((a,b)=>a+ (b.rate||0),0);
      const avg = ((baseSum + userSum) / total) || 0;
      avgScore.textContent = avg.toFixed(1);
      const rounded = Math.round(avg);
      avgStars.textContent = starLine(rounded);
      avgStars.setAttribute('aria-label', `Note moyenne ${avg.toFixed(1)} sur 5`);
    }

    // Charger les avis utilisateurs existants
    getReviews().forEach(renderUserReview);
    updateSummary();

    // Soumission
    form.addEventListener('submit', (e)=>{
      e.preventDefault();
      const name = nameEl.value.trim().slice(0,50);
      const text = textEl.value.trim().slice(0,300);
      const rateEl = form.querySelector('input[name="rate"]:checked');
      if(!name || !text || !rateEl){ alert('Merci de remplir votre nom, une note et un avis.'); return; }

      const rate = parseInt(rateEl.value,10);
      const reviews = getReviews();
      const rec = {name, text, rate, ts: Date.now()};
      reviews.push(rec);
      saveReviews(reviews);
      renderUserReview(rec);
      updateSummary();

      form.reset();
      // focus visuel
      nameEl.blur();
    });

    // Envoyer à l’équipe (ouvre e-mail)
    sendBtn.addEventListener('click', ()=>{
      const rateEl = form.querySelector('input[name="rate"]:checked');
      const name = nameEl.value.trim() || '(anonyme)';
      const rate = rateEl ? `${rateEl.value}/5` : '(non renseigné)';
      const text = textEl.value.trim() || '(vide)';
      const body = encodeURIComponent(
`Nouvel avis communauté LGBL

Nom: ${name}
Note: ${rate}
Avis:
${text}

(Envoyé depuis la page Communauté)`
      );
      const mailto = `mailto:lucasgaly.47510@gmail.com?subject=${encodeURIComponent('[Avis] Communauté LGBL')}&body=${body}`;
      window.location.href = mailto;
    });
  })();
</script>

</body>
</html>
